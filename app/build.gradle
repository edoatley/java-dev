plugins {
    id 'groovy'
    id 'war'
}

project.ext {
  versions = [
    jetty : '12.0.7',
    slf4j : '2.23.1'
  ]
}
repositories {
    // Use Maven Central for resolving dependencies.
    mavenCentral()
}

dependencies {

    // jetty
    implementation platform("org.eclipse.jetty:jetty-bom:$versions.jetty")
    implementation platform("org.eclipse.jetty.ee10:jetty-ee10-bom:$versions.jetty")
    implementation "org.eclipse.jetty:jetty-server"
    implementation "org.eclipse.jetty.ee10:jetty-ee10-servlet"
    implementation "org.eclipse.jetty.ee10:jetty-ee10-servlets"
    implementation "org.eclipse.jetty.ee10:jetty-ee10-webapp"
    implementation "javax.servlet:javax.servlet-api:4.0.1"

    // slf4j
    implementation "org.apache.logging.log4j:log4j-api:${versions.slf4j}"
    implementation "org.apache.logging.log4j:log4j-core:${versions.slf4j}"
    implementation "org.apache.logging.log4j:log4j-slf4j-impl:${versions.slf4j}"

    // Groovy / Spock / JUnit for testing
    testImplementation libs.groovy
    testImplementation libs.spock.core
    testImplementation libs.junit
    testImplementation 'org.codehaus.groovy.modules.http-builder:http-builder:0.7.1'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
    implementation libs.guava
    
}

// Apply a specific Java toolchain to ease working on different environments.
java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

tasks.named('test') {
    // Use JUnit Platform for unit tests.
    useJUnitPlatform()
    testLogging { 
        showStandardStreams = true
        exceptionFormat "full"
        minGranularity = 3
    }
}

// war {
//   manifest {
//     attributes(
//       'Class-Path': configurations.runtimeClasspath.collect { it.getName() }.join(' '),
//       'Main-Class': 'uk.org.edoatley.App'
//     )
//   }
// }